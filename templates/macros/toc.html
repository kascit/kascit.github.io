{% macro toc(page) %} {% if page.toc %}
<!-- Table of Contents - Desktop only (lg breakpoint and up) -->
<aside
  class="hidden lg:block"
  data-toc-expand="false"
  role="navigation"
  aria-label="Table of contents"
>
  <div class="sticky top-20 px-4 py-2 border-l border-gray-500/15">
    <h4 class="text-lg font-bold mb-1">ON THIS PAGE</h4>
    <ul class="menu menu-sm toc-menu">
      {% for h1 in page.toc %}
      <li>
        {% if h1.children %}
        <details class="toc-details">
          <summary
            role="button"
            data-toc-href="{{ h1.permalink | safe }}"
            aria-label="{{ h1.title }}"
          >
            <a href="{{ h1.permalink | safe }}" class="toc-link"
              >{{ h1.title }}</a
            >
          </summary>
          <ul>
            {% for h2 in h1.children %}
            <li>
              <a href="{{ h2.permalink | safe }}" class="toc-link"
                >{{ h2.title }}</a
              >
            </li>
            {% endfor %}
          </ul>
        </details>
        {% else %}
        <a href="{{ h1.permalink | safe }}" class="toc-link">{{ h1.title }}</a>
        {% endif %}
      </li>
      {% endfor %}
    </ul>
  </div>
</aside>
<script defer>
  document
    .querySelectorAll(".toc-menu summary[data-toc-href]")
    .forEach((summary) => {
      summary.addEventListener("click", function (e) {
        const href = this.getAttribute("data-toc-href");
        if (href && href.includes("#")) {
          const hash = href.split("#")[1];
          if (hash) {
            window.location.hash = hash;
          }
        }
      });
    });
</script>
{% endif %} {% endmacro toc %}
